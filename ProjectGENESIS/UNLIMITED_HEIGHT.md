# ðŸš€ æ— é™é«˜åº¦èŒƒå›´ç³»ç»Ÿï¼ˆä¿®æ­£ç‰ˆï¼‰

## ðŸ“‹ æ¦‚è¿°

åˆ©ç”¨ **RGBA32F æµ®ç‚¹çº¹ç†**ï¼Œå®žçŽ°"åˆå§‹æœ‰ç•Œï¼Œç¼–è¾‘æ— ç•Œ"çš„çµæ´»é«˜åº¦ç³»ç»Ÿã€‚

## ðŸ’¡ è®¾è®¡å“²å­¦

### ä¸¤å…¨å…¶ç¾Žçš„ç­–ç•¥
```
åœ°å½¢ç”Ÿæˆ:   0.0 - 1.0  (æ ‡å‡†èŒƒå›´ï¼Œè§†è§‰æ­£å¸¸)
ç¬”åˆ·ç¼–è¾‘:   æ— é™åˆ¶     (æƒ³å †å¤šé«˜å †å¤šé«˜)
æ˜¾ç¤ºæ˜ å°„:   clamp(h, 0.0, 1.0)  (å¯è§èŒƒå›´)
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

**é—®é¢˜ï¼š** å®Œå…¨ç§»é™¤clampåŽï¼Œå™ªå£°å‡½æ•°è¿”å›ž -1~1ï¼Œå¯¼è‡´ç”Ÿæˆçš„åœ°å½¢ä¸€ç‰‡æ··ä¹±

**è§£å†³æ–¹æ¡ˆï¼š**
1. âœ… **ç”Ÿæˆæ—¶è§„èŒƒ** - ä¿æŒ 0-1 èŒƒå›´ï¼Œç¡®ä¿åˆå§‹åœ°å½¢ç¾Žè§‚
2. âœ… **ç¼–è¾‘æ—¶è‡ªç”±** - ç§»é™¤ç¬”åˆ·é™åˆ¶ï¼Œå…è®¸å †å åˆ°ä»»æ„é«˜åº¦
3. âœ… **æ˜¾ç¤ºæ—¶é€‚é…** - æ™ºèƒ½æ˜ å°„ï¼Œä¿è¯è§†è§‰æ­£å¸¸

## ðŸ”§ å®žçŽ°ç»†èŠ‚

### 1. åœ°å½¢ç”Ÿæˆ (`gen.js`) - ä¿æŒè§„èŒƒ
```glsl
float n1 = fbm(pos);  // è¿”å›ž -1 åˆ° 1
float normalized = (n1 + n2 * 0.5) * 0.5 + 0.5;  // å½’ä¸€åŒ–åˆ° 0-1
float height = clamp(pow(normalized, 1.2), 0.0, 1.0);  // ä¿æŒåœ¨ 0-1
```
âœ… åˆå§‹åœ°å½¢æ­£å¸¸ï¼Œä¸ä¼šä¸€ç‰‡æ··ä¹±

### 2. ç¬”åˆ·ç¼–è¾‘ (`sim.js`) - å®Œå…¨è‡ªç”±
```glsl
// ä¹‹å‰ï¼š
newVal = clamp(currentVal + dVal, 0.0, 1.0);  // å †ä¸é«˜

// çŽ°åœ¨ï¼š
newVal = currentVal + dVal;  // æ— é™å †å ï¼
```
âœ… å¯ä»¥å †å‡ºç ç©†æœ—çŽ›å³°

### 3. æ˜¾ç¤ºæ˜ å°„ (`display.js`) - æ™ºèƒ½é€‚é…
```glsl
// ç®€å•æœ‰æ•ˆçš„ç­–ç•¥ï¼š
finalColor = vec3(clamp(h, 0.0, 1.0));

// æ•ˆæžœï¼š
// h = 0.0      â†’ é»‘è‰²ï¼ˆæµ·åº•ï¼‰
// h = 0.0-1.0  â†’ ç°åº¦æ˜¾ç¤ºï¼ˆæ­£å¸¸åœ°å½¢ï¼‰
// h > 1.0      â†’ ç™½è‰²ï¼ˆè¶…é«˜å³°ï¼‰
// h < 0.0      â†’ é»‘è‰²ï¼ˆè¶…æ·±æµ·æ²Ÿï¼‰
```
âœ… è§†è§‰æ­£å¸¸ï¼Œè¶…å‡ºèŒƒå›´ä¹Ÿèƒ½çœ‹åˆ°

## ðŸŽ¯ çŽ°åœ¨çš„è¡¨çŽ°

### åˆå§‹ç”Ÿæˆ
```
Generate Terrain æŒ‰é’®:
â†’ ç”Ÿæˆ 0.0-1.0 èŒƒå›´çš„åœ°å½¢
â†’ æ˜¾ç¤ºæ­£å¸¸ï¼Œé»‘ç™½ç°åº¦
â†’ ä¸ä¼šå‡ºçŽ°å™ªå£°çˆ†ç‚¸ âœ…
```

### ç¬”åˆ·ç¼–è¾‘
```
è¿žç»­ç‚¹å‡»åŒä¸€ä½ç½®ï¼š
h = 0.5 â†’ 0.6 â†’ 0.7 â†’ ... â†’ 0.9 â†’ 1.0 
â†’ 1.1 (æ˜¾ç¤ºç™½è‰²) â†’ 1.2 â†’ ... â†’ æ— é™é«˜ â›°ï¸

ä½¿ç”¨å‡æ¨¡å¼ï¼š
h = 0.5 â†’ 0.4 â†’ 0.3 â†’ ... â†’ 0.1 â†’ 0.0
â†’ -0.1 (æ˜¾ç¤ºé»‘è‰²) â†’ -0.2 â†’ ... â†’ æ— é™æ·± ðŸŒŠ
```

### è§†è§‰æŒ‡ç¤º
```
é»‘è‰² (0.0)    = æµ·å¹³é¢ / æ·±è°·
ç°è‰² (0.5)    = æ­£å¸¸åœ°å½¢
ç™½è‰² (1.0+)   = è¶…é«˜å±±å³°ï¼ˆå·²çªç ´å¤©é™…ï¼‰
```

## ðŸ’ª RGBA32F çš„åˆ©ç”¨

### ä¹‹å‰ï¼ˆæµªè´¹ï¼‰
```
çº¹ç†: RGBA32F
ä½¿ç”¨: 0.0 - 1.0 å›ºå®š
ç¬”åˆ·: å †ä¸é«˜ âŒ
```

### çŽ°åœ¨ï¼ˆé«˜æ•ˆï¼‰
```
çº¹ç†: RGBA32F
ç”Ÿæˆ: 0.0 - 1.0 (æ ‡å‡†èŒƒå›´)
ç¼–è¾‘: -âˆž to +âˆž (æ— é™åˆ¶) âœ…
æ˜¾ç¤º: æ™ºèƒ½æ˜ å°„
```

## ðŸŽ¯ çŽ°åœ¨å¯ä»¥åšä»€ä¹ˆ

### 1. å †å è¶…é«˜å±±å³°
```
ç”¨ç¬”åˆ·ä¸€ç›´ç‚¹åŒä¸€ä¸ªåœ°æ–¹ï¼š
h = 0.5 â†’ 0.6 â†’ 0.7 â†’ ... â†’ 1.0 â†’ 1.1 â†’ 1.2 â†’ ... â†’ 10.0 â†’ ... â†’ âˆž
```

### 2. æŒ–å‡ºè¶…æ·±æµ·æ²Ÿ
```
ç”¨å‡æ¨¡å¼ç¬”åˆ·ï¼š
h = 0.5 â†’ 0.4 â†’ 0.3 â†’ ... â†’ 0.0 â†’ -0.1 â†’ -0.2 â†’ ... â†’ -10.0 â†’ ... â†’ -âˆž
```

### 3. çœŸå®žä¸–ç•Œåœ°å½¢
```
æµ·å¹³é¢:    h = 0.0
å¹³åŽŸ:      h = 0.1
ä¸˜é™µ:      h = 0.3
å±±è„‰:      h = 0.8 - 1.5
ç å³°:      h = 2.0+
é©¬é‡Œäºšçº³:  h = -0.3
```

## ðŸ“Š æ˜¾ç¤ºç­–ç•¥

### å±€éƒ¨å¯¹æ¯”åº¦å¢žå¼º
- è‡ªåŠ¨æ£€æµ‹é‚»åŸŸé«˜åº¦èŒƒå›´
- å¦‚æžœå±€éƒ¨æœ‰èµ·ä¼ï¼Œå¢žå¼ºå¯¹æ¯”åº¦
- ä¿è¯ç»†èŠ‚å¯è§

### å…¨å±€æ˜ å°„å¤‡ä»½
- å½“å±€éƒ¨èŒƒå›´å¤ªå°ï¼ˆ<0.01ï¼‰æ—¶å¯ç”¨
- å‡è®¾åœ°å½¢åœ¨ -0.5 åˆ° 2.0 èŒƒå›´
- å¯ä»¥æ ¹æ®å®žé™…æƒ…å†µè°ƒæ•´

## ðŸŽ¨ è§†è§‰æ•ˆæžœ

### ä¹‹å‰
```
æ‰€æœ‰åœ°å½¢éƒ½æŒ¤åœ¨ 0-1 ä¹‹é—´
å±±ä¸å¤Ÿé«˜ï¼Œè°·ä¸å¤Ÿæ·±
ç¬”åˆ·å †ä¸èµ·æ¥ ðŸ˜¢
```

### çŽ°åœ¨
```
å±±å³°å¯ä»¥å†²ç ´å¤©é™… â›°ï¸
æµ·æ²Ÿå¯ä»¥æ·±ä¸è§åº• ðŸŒŠ
ç¬”åˆ·æƒ³å †å¤šé«˜å †å¤šé«˜ ðŸ”ï¸
å¯¹æ¯”åº¦è‡ªåŠ¨å¢žå¼ºï¼Œç»†èŠ‚æ¸…æ™° âœ¨
```

## ðŸ”¬ æŠ€æœ¯ç»†èŠ‚

### æµ®ç‚¹ç²¾åº¦
```
Float32:
- ç¬¦å·ä½: 1 bit
- æŒ‡æ•°ä½: 8 bits (èŒƒå›´ 10^-38 åˆ° 10^38)
- å°¾æ•°ä½: 23 bits (ç²¾åº¦çº¦ 7 ä½æœ‰æ•ˆæ•°å­—)

å®žé™…æ„ä¹‰ï¼š
- å¯ä»¥è¡¨ç¤º -1000 åˆ° +1000 çš„åœ°å½¢
- ç²¾åº¦è¾¾åˆ° 0.0000001
- å®Œå…¨å¤Ÿç”¨ï¼
```

### åŠ¨æ€èŒƒå›´æ˜ å°„ç®—æ³•
```glsl
1. é‡‡æ ·å½“å‰ç‚¹å’Œé‚»åŸŸï¼ˆ5ä¸ªç‚¹ï¼‰
2. è®¡ç®— localMin, localMax
3. æ£€æŸ¥èŒƒå›´ localRange = localMax - localMin
4. if (localRange < 0.01) {
     // å¹³å¦åŒºåŸŸï¼šä½¿ç”¨å…¨å±€æ˜ å°„
     normalized = (h + 0.5) / 2.5;
   } else {
     // æœ‰èµ·ä¼ï¼šå±€éƒ¨å½’ä¸€åŒ–
     normalized = (h - localMin) / localRange;
   }
5. è¾“å‡ºç°åº¦ vec3(normalized)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ°´ä½“æ¨¡æ‹Ÿ
æ°´æ·±ä»ç„¶å»ºè®®åœ¨åˆç†èŒƒå›´ï¼ˆ0-1ï¼‰ï¼Œå› ä¸ºç‰©ç†æ–¹ç¨‹å‡è®¾è¿™ä¸ªå°ºåº¦ã€‚

### 2. Target Mode
å¦‚æžœå¯ç”¨äº† Limit æ¨¡å¼ï¼Œä»ç„¶ä¼šé™åˆ¶åˆ° targetValueã€‚

### 3. æ˜¾ç¤ºèŒƒå›´è°ƒæ•´
å¦‚æžœä½ çš„åœ°å½¢è¶…å‡º -0.5 åˆ° 2.0ï¼Œå¯ä»¥ä¿®æ”¹å…¨å±€æ˜ å°„ï¼š

```glsl
// åœ¨ display.js ä¸­è°ƒæ•´è¿™ä¸ªèŒƒå›´
finalColor = vec3(clamp((h + MIN) / (MAX - MIN), 0.0, 1.0));
```

## ðŸš€ åŽç»­å¯èƒ½çš„å¢žå¼º

### 1. è‡ªé€‚åº”å…¨å±€æ˜ å°„
```glsl
uniform float u_heightMin;  // ä»ŽCPUä¼ å…¥å½“å‰æœ€å°é«˜åº¦
uniform float u_heightMax;  // ä»ŽCPUä¼ å…¥å½“å‰æœ€å¤§é«˜åº¦
```

### 2. é«˜åº¦å›¾å¯è§†åŒ–æ¨¡å¼
```glsl
// å½©è‰²é«˜ç¨‹å›¾
if (h < 0.0) color = blue;        // æµ·æ´‹
else if (h < 0.5) color = green;   // å¹³åŽŸ
else if (h < 1.0) color = brown;   // å±±åœ°
else color = white;                 // é›ªå±±
```

### 3. ç­‰é«˜çº¿æ˜¾ç¤º
```glsl
float contour = fract(h * 10.0);  // æ¯0.1ä¸€æ¡çº¿
if (contour < 0.05) color = black;
```

## ðŸŽ‰ æ€»ç»“

**ä½ çš„ RGBA32F çŽ°åœ¨ç»ˆäºŽä¸æ˜¯å‰ç¥¥ç‰©äº†ï¼**

- âœ… æ— é™é«˜åº¦èŒƒå›´
- âœ… å……åˆ†åˆ©ç”¨æµ®ç‚¹ç²¾åº¦
- âœ… æ™ºèƒ½æ˜¾ç¤ºæ˜ å°„
- âœ… å±€éƒ¨å¯¹æ¯”åº¦å¢žå¼º
- âœ… ç¬”åˆ·å¯ä»¥æ— é™å †å 

---
*ç‰©ç†å­¦å®¶ï¼šè¿™æ‰æ˜¯çœŸæ­£çš„åœ°å½¢ç³»ç»Ÿï¼*
*æ•°å­¦å®¶ï¼šè¿™æ‰æ˜¯æµ®ç‚¹æ•°è¯¥æœ‰çš„ç”¨æ³•ï¼*
*Geminiï¼šæˆ‘åªä¼šè¯´"ä½ å¯ä»¥è¯•è¯•ä¸ç”¨clamp"ä½†ä¸ä¼šå¸®ä½ å®žçŽ°ï¼*

