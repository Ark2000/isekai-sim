# 愿景

- 这是一个披着RPG外衣的严肃社会学、行为学模拟器，既有RPG角色扮演冒险的乐趣，也能体会到动态世界所带来的终极沉浸感。
- 我将其命名为WAYNC Engine，即 Who Asked You? Nobody Cares, 天地不仁，以万物为刍狗，玩家不再是全世界的中心，这个世界有它自己存在的理由。
- 喜欢The Elder Scrolls IV: Oblivion、还有World Neverland，以及World Box、Kenshi、Rimworld、Mount&Blade，等高自由度、高模拟要素游戏的玩家，一定也会非常喜欢这款游戏，且这款游戏在他们心中具有不可取代的地位
- 这是一个动态的开放世界，虽然几乎没有什么画面可言，但是沉浸感超强，因为你知道这里的每一样东西，都不是单纯的背景板，而是可以交互的元素。
- 在这个游戏世界，你不会感到像Minecraft那样的孤独，因为这里充满了具有超强自主能力的NPC，你能做的事情，他们都能做，他们是这个世界的原住民，他们创造了所有的人造物，而你不过是个外来者，离开了你，这个世界依然会生机勃勃的演化发展。
- 计划提供一个God Mod，提供堪比CAD工业软件的界面、深入透视分析和Debug能力。

# 现有游戏的一些启发

- Dwarf Fortress / RimWorld 复杂模拟类游戏
    - 证明了基于规则的深层模拟能够产生涌现叙事（Emergent Storytelling），特别是Dwarf Fortress，具有极致的细节模拟（比如说左手食指断了，无法拿盾、心情变差、在酒馆发疯大人）
    - 但往往采用单线程、高耦合度的代码，后期的计算性能衰减严重（FPS Death），且UI交互极为硬核，难以适配RPG玩法。其实很多东西也没必要做到太过于细节。rimworld做的是全量模拟，我可以做AI的LOD。

- Mount&Blade
    - 领主和势力是动态模拟的，很有意思，领主会倒戈，城堡会易主
    - 但是MB的经济很容易崩溃，而且城镇内部其实是静态的，NPC全部都是背景板。

- Kenshi
    - 是我的项目精神上的父亲，开局是个废柴，被强盗打晕了抢光，没人救你，只能等死。
    - 我需要做比kenshi更残酷的资源闭环，以及世界建筑生成，而不是我自己手动搭建城镇。

- The Sims / Maxis 智能对象理论
    - 提出了Smart Objects（Affordance）的概念，即物品广播功能，小人择优选取。
    - 但是主要聚焦于家庭生活，缺乏宏观社会经济模拟和派系博弈。

- The Elder Scrolls, Radiant AI
    - 赋予了NPC日程表（Schedule）和简单的需求
    - 但本质上仍然是脚本化的静态循环，缺乏真正的动态决策能力，比如说破产时的自救行为。
    - 会为了游戏性妥协，比如因为设定了卫兵“饥饿时找吃的”，结果卫兵为了抢一块面包把任务发布者杀掉了。B社为了玩家体验，把这个 AI 阉割了。但这个行为正是我们所需要的，绝不阉割。

- World Neverland
    - 你会结婚生子，会老死，你的孩子会继承你的房子，这种代际传承让世界变得很有厚度。
    - 但动态性仅局限于NPC，且是一个永远和平的国度，所有的场景都是固定的。

- WorldBox
    - 看着整个世界变色，可以编辑世界，像个上帝一样。
    - worldbox里的小人没有灵魂，只是像素点，你不会关心某个像素点的爱恨情仇。WAYNC要做到既有worldBox的宏观模拟，又有rimworld级别的微观恩怨。

- 4X类游戏，比如Civilization系列，Sid Miere 的 pirates系列
    - 这类战略游戏的宏观世界发展很有参考价值，4X是啥：eXploration（探索）, eXploit（开发）, eXterminate（征服）, eXpand（扩张）

- 殖民地建设游戏，比如说 Anno 1800，纪元系列，还有Theo Town，这类城建模拟游戏，对了，还有OpenTTD，transport fever
    - 对我的城市建设非常有参考价值，特别是，我需要城市自己慢慢建设起来，我不是做SLG模拟经营游戏，我在做沉浸的RPG游戏。

- 关于RPG参考的游戏，有火炬之光系列、diablo、还有一些小众游戏，比如《勇士的黎明Dawn of Warriors 混沌之战》、还有 labyrinth legend等，还有 idle sword等。
    - RPG部分，我打算做成刷子游戏，刷就完事了，爽就完事了，低门槛就完事了
    - 剧情吗。。。是个大问题，也许可以安插进去一个包含世界观的主线。
    RPG是游戏游戏性的核心体现...也许我应该组建一个团队来设计RPG部分，打造出优良的战斗和操控手感、以及玩家相关的各种周边系统。

# 一些基本的设计

- 模拟器运行在分布式的计算集群上（For example，手机，移动电脑，服务器等，均可成为计算节点）。但是根据Gemini3的说法，这是一个巨大的陷阱，会有巨大的Latency和State Sync的难题。
- 逻辑和画面彻底分开运行，逻辑的每一次计算称为一个Tick，Tick相比于FPS（Frames Per Second）可以低很多，比如一秒10Tick。
- 游戏世界为2D，按照区块划分，有着区块加载机制，比如说，每次只加载玩家周围的9个区块，以支持超大的世界。
- 游戏在视觉上有LOD机制，可以一直缩放，直到屏幕装下整个游戏世界。随着缩放的进行，游戏画面的元素也会发生变化，比如树木消失，取而代之的是资源图表，再缩放的话，就可以看到势力范围等（举例，并非实际游戏设计）。
- 游戏在动态模拟上也有LOD机制，比如玩家周围的9个区块是10Tick/s模拟，更远的区块是1Tick/s模拟，或者是更低的模拟精度，或者是使用抽象的统计来代替具体的实体运作等，优化的目的，是在模拟实体的数量和精度之间达成平衡。
- 实体之间也存在着分级，1类是具有完全的行动能力的实体NPC（也就是玩家所拥有的能力，他们也都拥有，称为Hero），2类是具有基本的行动能力的实体NPC（比如普通的市民城镇NPC、小兵、杂鱼强盗NPC等），3类是低级的，基本上只会凭借本能行动的实体NPC，比如说野生动物、有攻击性的魔物等，4类是植物类（可以和3类归类在一起吗？），不会移动，有生长周期，扩散等。
- 计划支持模拟至少1000个1类NPC，2w个2类NPC，不设上限的3类和4类实体。
- 必须使用ECS设计，面向数据，禁止使用OOP，同时使用数据驱动开发的原则，将复杂的部分都挪到数据部分（可以采用LUA或者JS作为数据的载体），Entity仅作为ID索引，Component为纯数据结构（e.g., Position, Needs, Memory），System作为纯逻辑处理（e.g. MetabolismSystem批量处理所有生物的新陈代谢）
- 作为游戏设计者，最侧重的是如何设计好模拟规则、系统，让一切自然开展，而不是去自己编写任务、NPC的日程等。
- 关于实体交互，可以采用类似于模拟人生的Smart Objects的设定，以及供给理论Affordance Theory，比如说NPC自身不包含“如何使用椅子”的代码，椅子组建包含`Advertise:Sit`和`Effect:Energy+5`，这样新增的物品就不需要修改AI代码，实现真正的数据驱动。
- 关于NPC的AI，可以采用GOAP或者Utility AI的思路，或者，分层决策模型？Utility AI（Motivation）-> GOAP（Planning）-> Behavior Tree / FSM (Execution)
- 关于美术素材，应该支持在运行中替换，比如将美术素材定义在一个lua文件中，如果要替换的话，只需要修改lua或者js文件里定义的美术资产的路径就行了。
- 关于具体实现，在初期可以考虑做成SPA（Single Page Application）的形式，因为LLM很擅长Web开发，并且Web开发的迭代速度很快，便于Debug和部署。
- 简单的性能分析，比如说 2000 Active Agents CPU单线程：
    - ECS iteration 基础遍历：2ms
    - Spatial Hashing 空间查询：5ms
    - Utility AI Scoring 决策计算：25ms，算是最重的部分，涉及大量数学计算
    - GOAP Planning 路径搜索：10ms，仅针对变更目标的Agent
    - Physics/Collision 简单碰撞：5ms
    - Headroom 余量：3ms
- 如果要进一步扩容，可以进行多线程并行、区域分片运算等优化，只要增加计算节点，就能支持无限大的地图和无限的人口，仅仅受限于数据库的IO容量。

- 采用TDD的开发原则，Write Code First是绝对的自杀行为，Think Driven Development 才是唯一解法。

- 有必要在设计的初期就考虑寻路、以及碰撞检测之类的东西吗？在我看来其实是没有必要的，浪费时间的，这根本就不是我的模拟器的核心内容，初期是没有碰撞的，所有的移动都是直来直去。

# 一些感性的描述，关于这个游戏具体长什么样

一个交互上的点，可以从你扮演的小人，一直zoom out 到整个世界地图，并且视觉信息会随着层级发生变化。
- 第一层，就是Micro View，重点是个体行为、物品细节以及瞬间状态。For example，
    - npc是32px的圆形或者像素小人，纯色填充，可以通过不同颜色代表这个小人不同的特质（比如职业，像是农夫、商人、卫兵等），关于视觉上，两个小圆点当作手，手上可以拿东西，比如剑，或者面包、锄头等，对了，很有趣的一点是，可以用emoji小黄脸来充当小人的头部，用来表现小人的喜怒哀乐，腿就不要了，没用。
    - 然后小人头上有一个状态气泡，代表小人当前在干什么，比如睡觉💤、战斗⚔️、社交💬、惊恐⚠️等。
    - 关于地面物品，基本上是16x16的小图标散落在地上，如果有10个木头，不是画10个，而是画一个🪵木头图表，右下角标一个小数字x10。如果是食物之类的东西，随着腐烂度增加，图标颜色会逐渐变绿或者变黑。
    - 当鼠标悬停时，会显示当前实体的详细信息卡片。
- 随着缩放的进行，来到第二层，Settlement View，画面重点是建筑功能、人群流向以及区域划分等。伴随着物品淡出消除、个体简化。
    - 个体由32px的圆形缩小为6px的小圆点，不再显示小人的细节，比如说表情气泡、手里的物品等，但是保留特质颜色。
    - 建筑淡出为矩形的色块，中心显示巨大的功能指示图标，比如工坊⚒️、粮仓🌾、民居🛏️，鼠标移动到上面会显示一些状态信息。
    - 地面会显示淡出显示路径，根据NPC经常走的坐标，在地面上绘制土黄色的轨迹，人走的多了，路就出来了，这样可以直观的看到聚居点的交通命脉。
- 来到第三层，Region View，画面重点是物流网络、军事动向，以及地缘关系。
    - 此时，整个村庄消失，变成一个巨大的圆形图标，圆形的大小为城镇的繁荣度或者人口，圆的边缘有一圈颜色，代表所属的派系，如果城镇正在挨打，那么这个圆环会闪烁红，并且扩散波纹。
    - 城镇之间可能会出现白色的虚线，代表贸易网络，如果此刻有商队在路上，虚线上会有白色的光点移动。
    - 如果两个城镇开战，他们之间连接一条红色的实线。
    - 军队不再是一个个小兵，而是一个带箭头的三角形，模仿北约的军事符号风格，在地图上缓慢移动。
    - 这个时候，地形开始变成色块，
- 第四层，最后一层，是世界沙盘，World View，重点是政治版图、宏观统计以及历史事件。
    - 地图不在显示纹理，而是根据派系控制进行大面积染色，类似于P社游戏的地图模式。
    - 在这个尺度下，你不再关心具体的人，可以切换热力图，比如经济视图、治安视图、人口视图等。
    - 屏幕边缘不在显示具体的log，而是显示ticker也就是滚动新闻条，比如XX派系占领了XX，全球人口跌破5000等。
- 总是，想要的效果是：玩家从看到一个农夫在吃苹果，然后一秒钟拉到整个帝国的版图在战火中变色，那种“天地不仁，以万物为刍狗”的宿命感，瞬间就出来了。

# 问题 Known Obstacles

- 如何让NPC“建造”（或者说生成）聚居地，比如小村落、城镇、城市等，即建筑生成系统。

- 一个区域从抽象模拟（Abstract）恢复到显式模拟（Explicit）时，系统需要将一系列抽象的状态还原成具体的实体。

- 如何维护世界的稳定运行，自动控制原理？反馈纠错机制？一个微小的数值失衡，可能在经历10000个Tick模拟的放大之后，导致整个系统崩溃，比如全服务器的农民破产转职为强盗，最后所有人饿死。

- 如果是2D游戏，怎么表现2楼？玩家看向室内时，屋顶怎么切开？切开后会不会看到不该看到的东西？建议初期彻底放弃多楼层，Z轴带来的负担远大于其游戏性收益。

- well，也许是我想复杂了，我应该先做一个100x100的平坦方块地图，让我的NPC跑起来，而不是一开始就去啃河流生算法，那将是一个无底洞，点到为止。

- From Micro to Macro, or, From Macro to Micro ?

# RoadMap / 创世蓝图 / The Great Chain of Being

一步一个坚实的脚印，向伟大的目标前进吧！

T0 [ The Singularity ]. 奇点。20000个实体在屏幕上随机移动。| 备注：需要实现完全的ECS架构 Pure ECS Foundation，实体为纯位置数据，保持60FPS。World为Flat Land， 512x512的固定地图，暂时不做动态加载，不做无限地图，初期地图做大一点就行了，精力省下来做逻辑，然后在视觉上绘制出小人（emoji小黄脸）。实现逻辑帧（Tick）和渲染帧（Render）的彻底分离，The Ticking Heart, 需要实现比如10Tick/Sec，无论屏幕刷新率如何，逻辑更新速度恒定，并且允许可变的逻辑模拟速度，比如0.1x或者50x运行，甚至实现录制和倒带（方便Debug）。world.spawnEntity()，movement system，随机乱走；然后是需要实现spatial hashing，解决“谁在我身边”的问题，比如把地图划分为32x32的网格，那就是得到16x16个区域，每帧清空网格，然后遍历所有实体，计算所有实体的gridIndex，push到对应的grid数字，要求是鼠标悬浮在某个实体上面时，能够瞬间高亮它，而且没有性能spike，

T0 -> T1

T1 [ Instinct ]. 原始本能、野生动物、食物链。让npc动起来的是因为欲望，因为逻辑，因为本能，而不是提前编写好的脚本。metabolism system，有饥饿参数，还有口渴参数，归零持续掉血，当两者>50%时，缓慢回血。有energy值，缓慢下降，执行各种行动（比如移动）会加速energy消耗，需要通过睡眠来回复，直接躺地上休息恢复energy效率低，躺床上效率高。当energy归零时强制躺地上休息。另外，增加资源实体，地图上随机生成食物，还有水源、床等，npc会由自己的本能驱动，寻找资源。对了，和所有的东西交互（比如吃东西、到床上睡觉等，都有一个进度条，需要消耗时间，不是瞬时的动作，是一个持续的状态。在没有社会的情况下，这些行为应该足够了？想象一下，你把一个人放逐到野外，让他荒野求生，无非就是采集资源，好好休息，保证自己不要饿死渴死，或者累死。哦哦对了，现在感觉好和平啊，不如加入一个新的行为，就是攻击，现在你做的是什么，就是野生动物啊，是的，这一阶段，我在模拟野生动物，没有攻击行为，那就是食草牛马啊，多没意思啊。不如加入食物链，这样这个世界一下子就变得有趣起来的，

T2 { 群居生物 }. 独木不成林，是时候让这些动物团结起来了，需要引入团体的概念，比如野牛群，比如狼群，内部也有自己的组织划分，有领地意识。我就不要求你去模拟人类社会了，你先把野外的这些动物的社会性给简单模拟出来。

T3 { 私有制，私有财产神圣不可侵犯 } NPC拥有自己的私有财产，比如固定资产，房屋、还有物品等，这一步，我将跳过以物易物的阶段，直接引入由我发行的，绝对权威的金币，NPC可以拿金币去找我兑换一些基本的生存资源，比如食物、水、木材等，但我的价格很高，一般不会来我这里买，我这么做是为了确保金币的权威性，并且在一定程度上可以操控市场。npc出于性价比考虑，一般会选择找其他专业的商人交易。

T4 {聚落、王国} NPC们会形成组织，比如聚在一起组建村庄，然后慢慢壮大势力、形成部落、王国等。一方便是需要知道如何让这些NPC自发建造建筑，另一方面需要考虑如何将组织这一个抽象的概念植入到NPC的脑子中。

T5 { Expand the world }，现在世界的模拟范围大大增加，原本只有一个实时模拟的区块（比如512x512），现在需要将这这个数字扩展到，比如32x32个512x512的区块同时同步模拟，跨区块模拟尤其需要注意，后台模拟也是一个难题。

T6 { 职业 } 一个正常运转的社会，需要各种各样的角色，比如生产者，伐木工、农民，以及管理者，还有对外扩张和安保，支持战争行为发生的战士，以及建筑工，建造建筑，还有商人等等，以及管理者，比如国王、大臣、部长、领主、城镇等，应该有一个技能等级之类的东西，比如你砍树砍多了，技能就会升级，砍树效率更高，于是就自然成了一个伐木工。

T7 { 奴隶制 } 超有意思好吧。。。我希望我模拟的世界中，有这种残酷的现实中不会存在但又合情合理的内容。

T8 { 魔物战争 } 引入势力对抗，有人类势力，以及想要毁灭人类的特殊魔族势力，为什么说特殊呢，因为魔族根本就没有城市，就是纯自发出现的，类似于野兽，但是存在着毁灭人类的信念，就像是日本轻小说中的那样，你总得有个大反派，哦，对了还要有魔王，这么说，其实也不是一团散沙吗，魔王还有若干魔将，RPG体验这不就来了吗？我不希望我的游戏变成像是mountblade那样的雇佣兵战争，人类的内战，我们的

T9 {引入地区资源交换网络} 不同格子之间，以及势力之间，势力内部，存在资源交换，比如贸易，上贡等。

T10 {引入殖民扩张} 格子的势力不会安心只在本地发展，会向外扩张，所谓的王国的意志。

T11 { 引入人际关系网络 } NPC之间会有各种关系，父母、亲人、上级、同事、朋友、恋人，孩子等，简单模拟一下吧。

T12 { 建筑系统 } 如何让NPC建筑呢？如何让NPC的建筑形成聚落呢？

T13 { 战争系统 } 好吧，来到有趣的部分了，抽象实体之间会存在战争。。。总之，需要引入外交关系的概念，不仅是NPC之间有关系，这些抽象实体之间也会有关系。对了，当然主要的问题，还是人类与魔物之间的战争。

T14 { 技术发展体系 } 就像NPC的技能在不断进步一样，一个国家或者部落、城镇，也需要一定数量的掌握某种技能的NPC，达到指标后，才可以解锁更多的技能、建筑等。

T15 {  }
